<!DOCTYPE html>
<html lang='en'>

<head>
    <title>FlowFiles</title>
    <link rel='stylesheet' type='text/css' href='css/main.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type='text/javascript' src='https://d3js.org/d3.v5.min.js'></script>
    <script type='text/javascript' src='js/common.js'></script>
    <script type='text/javascript' src='js/control-panel.js'></script>
    <script type='text/javascript' src='js/flow-file.js'></script>
    <script type='text/javascript' src='js/processor.js'></script>
    <script type='text/javascript' src='js/arrow.js'></script>
</head>

<body>
    <div id='diagram-container'>
        <svg id="diagram-svg" width="600px" height="600px">
            <defs>
                <marker id='head' orient="auto" markerWidth='2' markerHeight='4' refX='0.1' refY='2'>
                    <!-- triangle pointing right (+x) -->
                    <path d='M0,0 V4 L2,2 Z' fill="#AEBAA7" />
                </marker>
            </defs>
        </svg>
        <div id="control-panel">
            <i id="diagram-first" class="fa fa-angle-double-left"></i>
            <i id="diagram-previous" class="fa fa-angle-left"></i>
            <span id="diagram-index"></span>
            <i id="diagram-next" class="fa fa-angle-right"></i>
            <i id="diagram-last" class="fa fa-angle-double-right"></i>
        </div>
    
    </div>

    <script language='javascript'>
        var f1_1 = {
            position: { x: 20, y: 50 },
            id: '1',
            seq: '1',
            attributes: [
                {name: 'a', value: 'one'}
            ],
            content: {
                type: 'text',
                value: 'Hello world'
            },
            showData: true,
            showAttributes: true
        };

        var f1_2 = {
            position: { x: 20, y: 440 },
            id: '1',
            seq: '2',
            attributes: [
                {name: 'a', value: 'one'},
                {name: 'updatedAttr', value: 'ONE', highlight: true}
            ],
            content: {
                type: 'text',
                value: 'Hello world II'
            },
            showData: true,
            showAttributes: true
        };

        var p1 = {
            position: { x: 300, y: 250 },
            id: '1',
            name: 'UpdateAttribute',
            properties: [
                {
                    name: 'updatedAttr',
                    value: '${a:toUpper()}'
                }
            ],
            showDetails: true
        }

        var flowFiles = [];
        var processors = [];
        var arrows = [];

        var diagramSequence = {
            index: 0,
            actions: [
                () => {
                    flowFiles = [f1_1];
                    processors = [p1];
                    flowFile.render(flowFiles);
                    processor.render(processors);

                    var a1 = {
                        targets: [
                            flowFile.calculateBoundingBox(f1_1),
                            processor.calculateBoundingBox(p1)
                        ]
                    };

                    arrows = [a1];
                    arrow.render(arrows);
                },
                () => {
                    flowFiles.push(f1_2);
                    flowFile.render(flowFiles);

                    var a2 = {
                        targets: [
                            processor.calculateBoundingBox(p1),
                            flowFile.calculateBoundingBox(f1_2)
                        ]
                    };

                    arrows.push(a2);
                    arrow.render(arrows);
                }
            ]
        }
        controlPanel.render(diagramSequence);

    </script>
    </div>
</body>

</html>