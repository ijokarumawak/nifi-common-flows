<!DOCTYPE html>
<html lang='en'>

<head>
    <title>FlowFiles</title>
    <link rel='stylesheet' type='text/css' href='css/main.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type='text/javascript' src='https://d3js.org/d3.v5.min.js'></script>
    <script type='text/javascript' src='js/common.js'></script>
    <script type='text/javascript' src='js/renderable.js'></script>
    <script type='text/javascript' src='js/control-panel.js'></script>
    <script type='text/javascript' src='js/flow-file.js'></script>
    <script type='text/javascript' src='js/processor.js'></script>
    <script type='text/javascript' src='js/arrow.js'></script>
</head>

<body>
    <div id='diagram-container'>
        <svg id="diagram-svg" width="600px" height="600px">
            <defs>
                <marker id='head' orient="auto" markerWidth='2' markerHeight='4' refX='0.1' refY='2'>
                    <!-- triangle pointing right (+x) -->
                    <path d='M0,0 V4 L2,2 Z' fill="#AEBAA7" />
                </marker>
            </defs>
        </svg>
        <div id="control-panel">
            <i id="diagram-first" class="fa fa-angle-double-left"></i>
            <i id="diagram-previous" class="fa fa-angle-left"></i>
            <span id="diagram-index"></span>
            <i id="diagram-next" class="fa fa-angle-right"></i>
            <i id="diagram-last" class="fa fa-angle-double-right"></i>
        </div>
    
    </div>

    <script language='javascript'>
        var f1_1 = new FlowFile('1', 1);
        f1_1.position = { x: 20, y: 50 };
        f1_1.attributes = [{name: 'a', value: 'one'}];
        f1_1.content = {
            type: 'text',
            value: 'Hello world'
        };
        f1_1.showData = true;
        f1_1.showAttributes = true;

        var f1_2 = new FlowFile('1', 2);
        f1_2.position = { x: 20, y: 440 };
        f1_2.attributes = [
            {name: 'a', value: 'one'},
            {name: 'updatedAttr', value: 'ONE', highlight: true}
        ];
        f1_2.content = {
            type: 'text',
            value: 'Hello world'
        };
        f1_2.showData = true;
        f1_2.showAttributes = true;

        var p1 = new Processor('1', 'UpdateAttribute');
        p1.position = { x: 300, y: 250 };
        p1.properties = [
            {
                name: 'updatedAttr',
                value: '${a:toUpper()}'
            }
        ];
        p1.showDetails = true;

        var a1 = new Arrow('1', f1_1, p1);
        var a2 = new Arrow('2', p1, f1_2);

        var diagram = {
            index: 0,
            actions: [
                () => {
                    f1_1.render();
                    p1.render();
                    a1.render();

                    f1_2.hide();
                    a2.hide();
                },
                () => {
                    f1_2.render();
                    a2.render();
                }
            ]
        }
        controlPanel.render(diagram);

    </script>
    </div>
</body>

</html>